<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{component/header :: layout(~{::content})}">
  <th:block th:fragment="content">
    <main id="contents">
      <section class="section">
        <div class="container size-sm">
          <div class="login-wrap">
            <div class="login-header">
              <h2 class="section-title">비밀번호 찾기</h2>
              <p>가입 당시 입력된 아이디를 입력해주세요.</p>
            </div>

            <nav class="tabs" aria-label="페이지 이동">
              <a class="tab" onclick="Common.MiniSPA.go('/etc/idsrch/idSrch.do')">아이디 찾기</a>
              <a class="tab is-active" onclick="Common.MiniSPA.go('/etc/pwdsrch/pwdSrch.do')" aria-current="page">비밀번호
                찾기</a>
            </nav>

            <div class="gray-outer">
              <div class="form-box">
                <form id="pwdSearchForm" novalidate>
                  <div>
                    <p class="field-title">아이디</p>
                    <input id="mbrsId" name="mbrsId" type="text" class="text-field size-lg" placeholder="아이디를 입력해주세요."
                      autocomplete="username" required minlength="6" maxlength="15" pattern="^[a-z][a-z0-9._]{5,14}$" />
                  </div>

                  <div class="btn-wrap">
                    <button type="button" class="btn btn-darken-line size-lg"
                      onclick="Common.MiniSPA.go('/login/login.do')">취소</button>
                    <button type="submit" class="btn btn-primary size-lg">다음</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- 모달 -->
    <div class="modal" id="alert-modal" aria-hidden="true">
      <div class="modal-overlay" data-modal-close></div>
      <div class="modal-container" role="document" tabindex="-1">
        <section class="modal-body">
          <div class="modal-icon"><i class="icon icon-caution"></i></div>
          <p class="modal-desc">입력 정보를 확인해주세요.</p>
        </section>
        <footer class="modal-footer">
          <button type="button" class="btn btn-darken-line size-lg" data-modal-close>확인</button>
        </footer>
      </div>
    </div>

    <script>
      (function () {
        const form = document.getElementById("pwdSearchForm");
        const modal = document.getElementById("alert-modal");

        const openModal = (msg) => {
          modal.querySelector(".modal-desc").textContent = msg;
          modal.classList.add("is-active");
          modal.setAttribute("aria-hidden", "false");
          document.body.style.overflow = "hidden";
        };
        const closeModal = () => {
          modal.classList.remove("is-active");
          modal.setAttribute("aria-hidden", "true");
          document.body.style.overflow = "";
        };
        modal.querySelectorAll("[data-modal-close]").forEach(btn =>
          btn.addEventListener("click", closeModal)
        );

        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          const mbrsId = document.getElementById("mbrsId").value.trim();
          if (!mbrsId) {
            openModal("아이디를 입력해주세요.");
            return;
          }

          const url = `/etc/pwdsrch/pwdSrch2.do?mbrsId=${encodeURIComponent(mbrsId)}`;
          const res = await Common.sendSafe(url, {
            method: 'GET',
            expect: 'text',
            clientErrorMsg: '입력하신 아이디를 찾을 수 없습니다.',
            otherErrorMsg: '서버 통신 중 오류가 발생했습니다.'
          });

          if (res?.ok) {
            document.open();
            document.write(res.data);
            document.close();
          }
        });
      })();
    </script>
  </th:block>
</th:block>

</html>