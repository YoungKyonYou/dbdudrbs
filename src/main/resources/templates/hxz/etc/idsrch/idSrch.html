<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{component/header :: layout(~{::content})}">
    <th:block th:fragment="content">
        <main id="contents">
            <section class="section">
                <div class="container size-sm">
                    <div class="login-wrap">
                        <div class="login-header">
                            <h2 class="section-title">아이디 찾기</h2>
                            <p>가입 당시 입력된 아래의 정보를 입력해주세요.</p>
                        </div>

                        <nav class="tabs" aria-label="페이지 이동">
                            <a class="tab is-active" onclick="Common.MiniSPA.go('/etc/idsrch/idSrch.do')"
                                aria-current="page">아이디 찾기</a>
                            <a class="tab" onclick="Common.MiniSPA.go('/etc/pwdsrch/pwdSrch.do')">비밀번호 찾기</a>
                        </nav>

                        <div class="gray-outer">
                            <div class="form-box">
                                <form id="idSearchForm" novalidate>
                                    <div>
                                        <p class="field-title">성명</p>
                                        <input id="mbrsNm" name="mbrsNm" type="text" class="text-field size-lg"
                                            placeholder="성명을 입력해주세요." required minlength="2" maxlength="30"
                                            pattern="^[가-힣a-zA-Z·\\s]{2,30}$">
                                    </div>

                                    <div>
                                        <p class="field-title">생년월일</p>
                                        <input id="mbrsBrdt" name="mbrsBrdt" type="text" class="text-field size-lg"
                                            placeholder="예) 19850501" required maxlength="8" pattern="^\\d{8}$">
                                    </div>

                                    <div>
                                        <p class="field-title">휴대전화번호</p>
                                        <div class="flex align-center gap8">
                                            <input id="mbrsMbphNo1" type="text" class="text-field size-lg"
                                                inputmode="numeric" maxlength="3" required>
                                            <span class="flex-bar">-</span>
                                            <input id="mbrsMbphNo2" type="text" class="text-field size-lg"
                                                inputmode="numeric" maxlength="4" required>
                                            <span class="flex-bar">-</span>
                                            <input id="mbrsMbphNo3" type="text" class="text-field size-lg"
                                                inputmode="numeric" maxlength="4" required>
                                        </div>
                                    </div>

                                    <button type="submit" class="btn btn-primary btn-icon-right size-lg">
                                        <i class="icon icon-search"></i>아이디 찾기
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- 모달 -->
        <div class="modal" id="alert-modal" aria-hidden="true">
            <div class="modal-overlay" data-modal-close></div>
            <div class="modal-container" role="document" tabindex="-1">
                <section class="modal-body">
                    <div class="modal-icon"><i class="icon icon-caution"></i></div>
                    <p class="modal-desc">입력 정보를 확인해주세요.</p>
                </section>
                <footer class="modal-footer">
                    <button type="button" class="btn btn-darken-line size-lg" data-modal-close>확인</button>
                </footer>
            </div>
        </div>

        <script>
            (function () {
                const form = document.getElementById("idSearchForm");
                const modal = document.getElementById("alert-modal");

                const openModal = (msg) => {
                    modal.querySelector(".modal-desc").textContent = msg;
                    modal.classList.add("is-active");
                    modal.setAttribute("aria-hidden", "false");
                    document.body.style.overflow = "hidden";
                };
                const closeModal = () => {
                    modal.classList.remove("is-active");
                    modal.setAttribute("aria-hidden", "true");
                    document.body.style.overflow = "";
                };
                modal.querySelectorAll("[data-modal-close]").forEach(btn =>
                    btn.addEventListener("click", closeModal)
                );

                form.addEventListener("submit", async (e) => {
                    e.preventDefault();

                    const mbrsNm = document.getElementById("mbrsNm").value.trim();
                    const mbrsBrdt = document.getElementById("mbrsBrdt").value.trim();
                    const mb1 = document.getElementById("mbrsMbphNo1").value.trim();
                    const mb2 = document.getElementById("mbrsMbphNo2").value.trim();
                    const mb3 = document.getElementById("mbrsMbphNo3").value.trim();

                    if (!mbrsNm || !mbrsBrdt || !mb1 || !mb2 || !mb3) {
                        openModal("모든 항목을 입력해주세요.");
                        return;
                    }

                    // ✅ 세 번호를 하나로 합침
                    const mbrsMbphNo = mb1 + mb2 + mb3;

                    const params = new URLSearchParams({
                        mbrsNm,
                        mbrsBrdt,
                        mbrsMbphNo
                    }).toString();

                    const url = `/etc/idsrch/idSrch2.do?${params}`;

                    const res = await Common.sendSafe(url, {
                        method: 'GET',
                        expect: 'text',
                        clientErrorMsg: '입력하신 정보로 회원을 찾을 수 없습니다.',
                        otherErrorMsg: '서버 통신 중 오류가 발생했습니다.'
                    });

                    if (res?.ok) {
                        document.open();
                        document.write(res.data);
                        document.close();
                    }
                });
            })();
        </script>
    </th:block>
</th:block>

</html>