<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{component/header :: layout(~{::content})}">
    <th:block th:fragment="content">
        <main id="contents">
            <section class="section">
                <div class="container size-sm">
                    <div class="login-wrap">
                        <div class="login-header">
                            <h2 class="section-title">아이디 찾기</h2>
                            <p>가입 당시 입력된 아래의 정보를 입력해주세요.</p>
                        </div>

                        <nav class="tabs" aria-label="페이지 이동">
                            <a class="tab is-active" onclick="Common.MiniSPA.go('/etc/idsrch/idSrch.do')"
                                aria-current="page">
                                아이디 찾기
                            </a>
                            <a class="tab" onclick="Common.MiniSPA.go('/etc/pwdsrch/pwdSrch.do')">
                                비밀번호 찾기
                            </a>
                        </nav>

                        <div class="gray-outer">
                            <div class="form-box">
                                <form id="idSearchForm" action="/etc/idsrch/findMbrsId.do" method="post" novalidate>

                                    <div>
                                        <p class="field-title">성명</p>
                                        <label for="mbrsNm" class="sr-only">성명</label>
                                        <input id="mbrsNm" name="mbrsNm" type="text" class="text-field size-lg"
                                            placeholder="성명을 입력해주세요." autocomplete="name" inputmode="text" required
                                            aria-required="true" minlength="2" maxlength="30"
                                            pattern="^[가-힣a-zA-Z·\\s]{2,30}$">
                                    </div>

                                    <div>
                                        <p class="field-title">생년월일</p>
                                        <label for="mbrsBrdt" class="sr-only">생년월일</label>
                                        <input id="mbrsBrdt" name="mbrsBrdt" type="text" class="text-field size-lg"
                                            placeholder="예) 19850501" autocomplete="bday" inputmode="numeric" required
                                            aria-required="true" maxlength="8" pattern="^\\d{8}$">
                                    </div>

                                    <!-- 휴대전화번호 -->
                                    <div>
                                        <p class="field-title">휴대전화번호</p>
                                        <fieldset>
                                            <legend class="sr-only">휴대전화번호</legend>
                                            <div class="flex align-center gap8">
                                                <label for="mbrsMbphNo1" class="sr-only">국번</label>
                                                <input id="mbrsMbphNo1" name="mbrsMbphNo1" type="text"
                                                    class="text-field size-lg" inputmode="numeric" pattern="[0-9]*"
                                                    maxlength="3">

                                                <span class="flex-bar" aria-hidden="true">-</span>

                                                <label for="mbrsMbphNo2" class="sr-only">중간번호</label>
                                                <input id="mbrsMbphNo2" name="mbrsMbphNo2" type="text"
                                                    class="text-field size-lg" inputmode="numeric" pattern="[0-9]*"
                                                    maxlength="4">

                                                <span class="flex-bar" aria-hidden="true">-</span>

                                                <label for="mbrsMbphNo3" class="sr-only">끝번호</label>
                                                <input id="mbrsMbphNo3" name="mbrsMbphNo3" type="text"
                                                    class="text-field size-lg" inputmode="numeric" pattern="[0-9]*"
                                                    maxlength="4">
                                            </div>
                                        </fieldset>
                                    </div>

                                    <button type="submit" class="btn btn-primary btn-icon-right size-lg">
                                        <i class="icon icon-search"></i>아이디 찾기
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const form = document.getElementById("idSearchForm");

                form.addEventListener("submit", async (e) => {
                    e.preventDefault();

                    const mbrsNm = document.getElementById("mbrsNm").value.trim();
                    const mbrsBrdt = document.getElementById("mbrsBrdt").value.trim();
                    const mbph1 = document.getElementById("mbrsMbphNo1").value.trim();
                    const mbph2 = document.getElementById("mbrsMbphNo2").value.trim();
                    const mbph3 = document.getElementById("mbrsMbphNo3").value.trim();
                    const mbrsMbphNo = `${mbph1}-${mbph2}-${mbph3}`;

                    const body = {
                        req: { mbrsNm, mbrsBrdt, mbrsMbphNo }
                    };

                    try {
                        const out = await Common.sendSafe(
                            form.getAttribute("action"),
                            {
                                method: "POST",
                                data: body,
                                headers: { "Content-Type": "application/json" },
                                expect: "json"
                            }
                        );

                        if (out?.mbrsId) {
                            alert(`회원님의 아이디는 [${out.mbrsId}] 입니다.`);
                        } else {
                            alert("입력하신 정보로 일치하는 회원이 없습니다.");
                        }
                    } catch (err) {
                        console.error(err);
                        alert("아이디 조회 중 오류가 발생했습니다.");
                    }
                });
            });
        </script>
    </th:block>
</th:block>

</html>