<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{component/header :: layout(~{::content})}">
  <th:block th:fragment="content">

    <main id="contents">
      <section class="section">
        <div class="container fluid">
          <div class="join-wrap">
            <div class="join-header">
              <h2 class="section-title">íšŒì›ê°€ì…</h2>
              <ol class="step-box" role="list" aria-label="íšŒì›ê°€ì… ë‹¨ê³„">
                <li>
                  <div class="circle"><span>1</span><i class="icon document"></i></div>
                  <p>ì•½ê´€ë™ì˜</p>
                </li>
                <li>
                  <div class="circle"><span>2</span><i class="icon lock"></i></div>
                  <p>ë³¸ì¸ì¸ì¦</p>
                </li>
                <li aria-current="step" class="active">
                  <div class="circle"><span>3</span><i class="icon write"></i></div>
                  <p>ì •ë³´ì…ë ¥</p>
                </li>
                <li>
                  <div class="circle"><span>4</span><i class="icon check"></i></div>
                  <p>ê°€ì…ì™„ë£Œ</p>
                </li>
              </ol>
            </div>
          </div>
        </div>

        <div class="container size-xsm">
          <div class="join-wrap">
            <div class="form-box">
              <form id="joinForm" method="post" novalidate>

                <!-- ì•„ì´ë”” -->
                <div>
                  <label class="field-title" for="userId">ì•„ì´ë”” <span class="color-error">*</span></label>
                  <div class="flex gap8">
                    <input id="userId" name="userId" type="text" class="text-field size-lg" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."
                      minlength="6" maxlength="15" pattern="^[a-z][a-z0-9_]{5,14}$" required
                      aria-describedby="userIdHelp">
                    <button type="button" id="checkIdBtn" class="btn btn-darkgray size-lg">ì¤‘ë³µí™•ì¸</button>
                  </div>
                  <p class="guide-text" id="userIdHelp">â€» ì˜ë¬¸ì†Œë¬¸ì, ìˆ«ì, ì¼ë¶€ íŠ¹ìˆ˜ë¬¸ì(_) 6~15ì (ì‹œì‘ì€ ì˜ë¬¸ì)</p>
                  <p id="idCheckMsg" class="guide-text" style="margin-top:4px;"></p>
                </div>

                <!-- ë¹„ë°€ë²ˆí˜¸ -->
                <div>
                  <label class="field-title" for="password">ë¹„ë°€ë²ˆí˜¸ <span class="color-error">*</span></label>
                  <input id="password" name="password" type="password" class="text-field size-lg"
                    placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”." required minlength="8" maxlength="20">
                  <p class="guide-text" id="pwdHelp1">â€» ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì ì¤‘ 2ê°€ì§€ ì´ìƒ í˜¼í•© 8~20ì (ì˜ë¬¸ì í•„ìˆ˜)</p>
                  <p class="guide-text" id="pwdHelp2">â€» ì•„ì´ë””ê°€ í¬í•¨ëœ ë¹„ë°€ë²ˆí˜¸ëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                  <p id="pwdMsg" class="guide-text" style="margin-top:4px;"></p>
                </div>

                <!-- ë¹„ë°€ë²ˆí˜¸ í™•ì¸ -->
                <div>
                  <label class="field-title" for="passwordConfirm">ë¹„ë°€ë²ˆí˜¸ í™•ì¸ <span class="color-error">*</span></label>
                  <input id="passwordConfirm" name="passwordConfirm" type="password" class="text-field size-lg"
                    placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”." required minlength="8" maxlength="20">
                </div>

                <!-- íœ´ëŒ€ì „í™”ë²ˆí˜¸ -->
                <div>
                  <p class="field-title">íœ´ëŒ€ì „í™”ë²ˆí˜¸ <span class="color-error">*</span></p>
                  <fieldset>
                    <legend class="sr-only">íœ´ëŒ€ì „í™”ë²ˆí˜¸</legend>
                    <div class="flex align-center gap8">
                      <input id="mobile1" type="text" class="text-field size-lg" value="010" readonly>
                      <span class="flex-bar">-</span>
                      <input id="mobile2" type="text" class="text-field size-lg" placeholder="1234" inputmode="numeric">
                      <span class="flex-bar">-</span>
                      <input id="mobile3" type="text" class="text-field size-lg" placeholder="5678" inputmode="numeric">
                    </div>
                  </fieldset>
                </div>

                <!-- ì „í™”ë²ˆí˜¸ -->
                <div>
                  <p class="field-title">ì „í™”ë²ˆí˜¸ (ì„ íƒ)</p>
                  <fieldset>
                    <div class="flex align-center gap8">
                      <input id="tel1" type="text" class="text-field size-lg" placeholder="02" inputmode="numeric">
                      <span class="flex-bar">-</span>
                      <input id="tel2" type="text" class="text-field size-lg" placeholder="1234" inputmode="numeric">
                      <span class="flex-bar">-</span>
                      <input id="tel3" type="text" class="text-field size-lg" placeholder="5678" inputmode="numeric">
                    </div>
                  </fieldset>
                </div>

                <!-- ì´ë©”ì¼ -->
                <div>
                  <label class="field-title" for="emailId">ì´ë©”ì¼ (ì„ íƒ)</label>
                  <div class="flex align-center gap8">
                    <input id="emailId" type="text" class="text-field size-lg" placeholder="ì•„ì´ë””">
                    <span class="flex-bar">@</span>
                    <input id="emailDomainManual" type="text" class="text-field size-lg" placeholder="ë„ë©”ì¸ ì§ì ‘ ì…ë ¥">
                  </div>
                </div>

                <button type="submit" class="btn btn-primary size-lg">ì™„ë£Œ</button>
              </form>
            </div>
          </div>
        </div>
      </section>
    </main>

    <script>
      (function () {
        const userId = document.getElementById('userId');
        const checkBtn = document.getElementById('checkIdBtn');
        const idMsg = document.getElementById('idCheckMsg');
        const form = document.getElementById('joinForm');
        const pwd = document.getElementById('password');
        const pwdConfirm = document.getElementById('passwordConfirm');
        const pwdMsg = document.getElementById('pwdMsg');

        // ğŸ”¹ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ë©”ì‹œì§€ìš© ìš”ì†Œ ì¶”ê°€
        const pwdConfirmMsg = document.createElement('p');
        pwdConfirmMsg.id = 'pwdConfirmMsg';
        pwdConfirmMsg.className = 'guide-text';
        pwdConfirmMsg.style.marginTop = '4px';
        pwdConfirm.insertAdjacentElement('afterend', pwdConfirmMsg);

        let idChecked = false;

        const idRegex = /^[a-z][a-z0-9_]{5,14}$/;
        const pwdRegex = /^(?=.*[a-zA-Z])(?:(?=.*\d)|(?=.*[^a-zA-Z0-9])).{8,20}$/;

        // ì•„ì´ë”” ì¤‘ë³µ í™•ì¸
        checkBtn.addEventListener('click', () => {
          const id = userId.value.trim();
          idChecked = false;
          idMsg.textContent = '';

          if (!idRegex.test(id)) {
            alert("ì•„ì´ë””ëŠ” ì˜ë¬¸ ì†Œë¬¸ìì™€ ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì(_)ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.\n6~15ì, ì˜ë¬¸ìœ¼ë¡œ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤.");
            idMsg.textContent = "âŒ ì•„ì´ë”” ê·œì¹™ ë¶ˆì¼ì¹˜";
            idMsg.style.color = "red";
            return;
          }

          // ì˜ˆì‹œ: ì‹¤ì œ ì„œë²„ ì—°ë™ ëŒ€ì‹  ëœë¤
          const isDuplicate = Math.random() < 0.5;

          if (isDuplicate) {
            idMsg.textContent = "âŒ ì´ë¯¸ ì‚¬ìš©ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.";
            idMsg.style.color = "red";
          } else {
            idMsg.textContent = "âœ… ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.";
            idMsg.style.color = "green";
            idChecked = true;
          }
        });

        // ë¹„ë°€ë²ˆí˜¸ ìœ íš¨ì„± ì‹¤ì‹œê°„ ì²´í¬
        pwd.addEventListener('input', () => {
          const password = pwd.value.trim();
          const idValue = userId.value.trim();

          if (!pwdRegex.test(password)) {
            pwdMsg.textContent = "âŒ ë¹„ë°€ë²ˆí˜¸ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.";
            pwdMsg.style.color = "red";
          } else if (idValue && password.includes(idValue)) {
            pwdMsg.textContent = "âŒ ë¹„ë°€ë²ˆí˜¸ì— ì•„ì´ë””ë¥¼ í¬í•¨í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
            pwdMsg.style.color = "red";
          } else {
            pwdMsg.textContent = "âœ… ì‚¬ìš© ê°€ëŠ¥í•œ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.";
            pwdMsg.style.color = "green";
          }

          checkPasswordMatch();
        });

        pwdConfirm.addEventListener('input', checkPasswordMatch);

        function checkPasswordMatch() {
          const password = pwd.value.trim();
          const confirm = pwdConfirm.value.trim();

          if (!confirm) {
            pwdConfirmMsg.textContent = "";
            return;
          }

          if (password === confirm) {
            pwdConfirmMsg.textContent = "âœ… ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.";
            pwdConfirmMsg.style.color = "green";
          } else {
            pwdConfirmMsg.textContent = "âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
            pwdConfirmMsg.style.color = "red";
          }
        }

        const numberOnlyFields = ['mobile2', 'mobile3', 'tel1', 'tel2', 'tel3'];
        numberOnlyFields.forEach(id => {
          const field = document.getElementById(id);
          field.addEventListener('input', () => {
            field.value = field.value.replace(/[^0-9]/g, '');
          });
        });

        form.addEventListener('submit', (e) => {
          e.preventDefault();

          if (!userId.value.trim()) {
            alert("ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            userId.focus();
            return;
          }

          if (!idChecked) {
            alert("ì•„ì´ë”” ì¤‘ë³µ í™•ì¸ì„ í•´ì£¼ì„¸ìš”.");
            return;
          }

          const password = pwd.value.trim();
          const confirm = pwdConfirm.value.trim();

          if (!password) {
            alert("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
          }

          if (!pwdRegex.test(password)) {
            alert("ë¹„ë°€ë²ˆí˜¸ëŠ” ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì ì¤‘ 2ê°€ì§€ ì´ìƒ ì¡°í•© 8~20ìì´ë©° ì˜ë¬¸ì„ ë°˜ë“œì‹œ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.");
            return;
          }

          if (password.includes(userId.value.trim())) {
            alert("ë¹„ë°€ë²ˆí˜¸ì— ì•„ì´ë””ë¥¼ í¬í•¨í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            return;
          }

          if (password !== confirm) {
            pwdConfirmMsg.textContent = "âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
            pwdConfirmMsg.style.color = "red";
            pwdConfirm.focus();
            return;
          }

          const m2 = document.getElementById('mobile2').value.trim();
          const m3 = document.getElementById('mobile3').value.trim();
          if (!m2 || !m3) {
            alert("íœ´ëŒ€ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
          }

          alert("íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!");
          window.location.href = '/etc/mbrsjoin/step4.do'
        });
      })();
    </script>


  </th:block>
</th:block>

</html>