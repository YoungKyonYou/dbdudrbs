<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{component/header :: layout(~{::content})}">
    <th:block th:fragment="content">
        <main id="contents">
            <section class="section">
                <div class="container fluid">
                    <div class="join-wrap">
                        <div class="join-header">
                            <h2 class="section-title">회원가입</h2>
                            <ol class="step-box" role="list" aria-label="회원가입 단계">
                                <li id="step1Circle" aria-current="step" class="active">
                                    <div class="circle" aria-hidden="true"><span>1</span><i class="icon document"></i>
                                    </div>
                                    <p>약관동의 <span class="sr-only">(현재 단계)</span></p>
                                </li>
                                <li id="step2Circle">
                                    <div class="circle" aria-hidden="true"><span>2</span><i class="icon lock"></i></div>
                                    <p>본인인증</p>
                                </li>
                                <li id="step3Circle">
                                    <div class="circle" aria-hidden="true"><span>3</span><i class="icon write"></i>
                                    </div>
                                    <p>정보입력</p>
                                </li>
                                <li id="step4Circle">
                                    <div class="circle" aria-hidden="true"><span>4</span><i class="icon check"></i>
                                    </div>
                                    <p>가입완료</p>
                                </li>
                            </ol>
                        </div>
                    </div>
                </div>

                <div class="container">
                    <div class="join-wrap">
                        <!-- STEP1 FORM -->
                        <form id="step1Form" class="step-form" data-step="1" action="/etc/mbrsjoin/start" method="POST">
                            <input type="hidden" name="nonce" value="">
                            <div class="line-box-wrap">
                                <!-- 약관 반복 -->
                                <div class="agreement" data-required="true" data-key="mrkgUtlzAgrmYn">
                                    <div class="line-box">
                                        <div class="top-box">이용약관 <span class="color-error">(필수)</span></div>
                                        <div class="bot-box scroll-y">이용약관 전문(생략)</div>
                                    </div>
                                    <div class="btn-wrap">
                                        <button type="button" class="btn btn-darken-line size-md disagree">동의하지
                                            않음</button>
                                        <button type="button" class="btn btn-darkgray size-md view">약관내용 확인</button>
                                    </div>
                                </div>
                                <div class="agreement" data-required="true" data-key="smsRcvAgrmYn">
                                    <div class="line-box">
                                        <div class="top-box">개인정보 수집 및 이용 안내 <span class="color-error">(필수)</span></div>
                                        <div class="bot-box scroll-y">개인정보 수집 이용 전문(생략)</div>
                                    </div>
                                    <div class="btn-wrap">
                                        <button type="button" class="btn btn-darken-line size-md disagree">동의하지
                                            않음</button>
                                        <button type="button" class="btn btn-darkgray size-md view">약관내용 확인</button>
                                    </div>
                                </div>
                                <div class="agreement" data-required="true" data-key="mailRcvAgrmYn">
                                    <div class="line-box">
                                        <div class="top-box">행정정보공동이용 사전동의 <span class="color-error">(필수)</span></div>
                                        <div class="bot-box scroll-y">행정정보 전문(생략)</div>
                                    </div>
                                    <div class="btn-wrap">
                                        <button type="button" class="btn btn-darken-line size-md disagree">동의하지
                                            않음</button>
                                        <button type="button" class="btn btn-darkgray size-md view">약관내용 확인</button>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary size-lg finish btn-disabled">다음</button>
                        </form>

                        <!-- STEP2 FORM (본인인증) -->
                        <form id="step2Form" class="step-form" data-step="2" action="/etc/mbrsjoin/verify" method="POST"
                            style="display:none;">
                            <input type="hidden" name="nonce" value="">
                            <!-- 본인인증 UI 넣기 -->
                            <button type="submit" class="btn btn-primary size-lg finish btn-disabled">다음</button>
                        </form>

                        <!-- STEP3 FORM (정보입력) -->
                        <form id="step3Form" class="step-form" data-step="3" action="/etc/mbrsjoin/submit" method="POST"
                            style="display:none;">
                            <input type="hidden" name="nonce" value="">
                            <!-- 정보 입력 UI 넣기 -->
                            <button type="submit" class="btn btn-primary size-lg finish btn-disabled">가입완료</button>
                        </form>

                    </div>
                </div>
            </section>
        </main>

        <script th:inline="javascript">
            (function () {
                const stepForms = document.querySelectorAll('.step-form');
                const stepCircles = document.querySelectorAll('.step-box li');



                // Step1 약관 버튼 활성화
                const step1Form = document.getElementById('step1Form');
                const step1Next = step1Form.querySelector('.finish');
                const agreements = step1Form.querySelectorAll('.agreement');

                agreements.forEach(ag => {
                    const viewBtn = ag.querySelector('.view');
                    const disagreeBtn = ag.querySelector('.disagree');
                    ag.dataset.agreed = "false";

                    viewBtn.addEventListener('click', () => {
                        ag.dataset.agreed = "true";
                        viewBtn.classList.replace('btn-darkgray', 'btn-primary');
                        disagreeBtn.classList.replace('btn-warning', 'btn-darken-line');
                        updateNextBtn();
                    });

                    disagreeBtn.addEventListener('click', () => {
                        ag.dataset.agreed = "false";
                        viewBtn.classList.replace('btn-primary', 'btn-darkgray');
                        disagreeBtn.classList.replace('btn-darken-line', 'btn-warning');
                        updateNextBtn();
                    });
                });

                function updateNextBtn() {
                    const allAgreed = Array.from(agreements).every(ag => ag.dataset.agreed === "true");
                    step1Next.classList.toggle('btn-disabled', !allAgreed);
                    step1Next.disabled = !allAgreed;
                }

                // Step1 제출 → UI만 Step2로
                step1Form.addEventListener('submit', e => {
                    e.preventDefault();
                    Common.MiniSPA.go('/etc/mbrsjoin/step2.do')
                });

            })();
        </script>



    </th:block>
</th:block>

</html>