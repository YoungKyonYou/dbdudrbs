<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{component/header :: layout(~{::content})}">
  <th:block th:fragment="content">

    <main id="contents">
      <section class="section">
        <div class="container fluid">
          <div class="join-wrap">
            <div class="join-header">
              <h2 class="section-title">지원 사업 가입하기</h2>
              <ol class="step-box" role="list" aria-label="지원사업 가입 단계">
                <li aria-current="step" class="active">
                  <div class="circle" aria-hidden="true">
                    <span>1</span>
                    <i class="icon home"></i>
                  </div>
                  <p>거주지인증 <span class="sr-only">(현재 단계)</span></p>
                </li>
                <li>
                  <div class="circle" aria-hidden="true">
                    <span>2</span>
                    <i class="icon filter"></i>
                  </div>
                  <p>인증 및 유형 선택</p>
                </li>
                <li>
                  <div class="circle" aria-hidden="true">
                    <span>3</span>
                    <i class="icon check"></i>
                  </div>
                  <p>가입완료</p>
                </li>
              </ol>
            </div>
          </div>
        </div>
        <div class="container size-xsm">
          <div class="join-wrap">
            <div class="causion-text">
              <strong>
                <span class="color-secondary">종로구 지역 주민</span>
                <span>만 신청할 수 있습니다.</span>
              </strong>
              <p class="guide-text">※ 행정안전부 행정정보공동이용센터와 연계한 인증으로 이용자가 많을 경우 약 5분 정도 소요됩니다.</p>
            </div>
            <div class="form-box">
              <form id="rsdcAuthForm" action="" method="post" novalidate>
                <fieldset>
                  <p class="field-title">주민등록번호</p>
                  <legend class="sr-only">주민등록번호</legend>
                  <div class="sr-only" id="rrnHelp">앞 6자리(생년월일)와 뒤 7자리를 순서대로 입력하세요.</div>

                  <div class="flex align-center gap8" role="group" aria-describedby="rrnHelp rrnErr">
                    <label for="rrn1" class="sr-only">앞 6자리</label>
                    <input id="rrn1" name="rrn1" type="text" class="text-field size-lg" placeholder="YYMMDD"
                      inputmode="numeric" autocomplete="off" required aria-required="true" minlength="6" maxlength="6"
                      pattern="^\d{6}$" aria-describedby="rrnHelp rrnErr">

                    <span class="flex-bar" aria-hidden="true">-</span>

                    <label for="rrn2" class="sr-only">뒤 7자리</label>
                    <input id="rrn2" name="rrn2" type="password" class="text-field size-lg" placeholder="*******"
                      inputmode="numeric" autocomplete="off" required aria-required="true" minlength="7" maxlength="7"
                      pattern="^[1-8]\d{6}$" aria-describedby="rrnHelp rrnErr">
                  </div>
                </fieldset>

                <button type="submit" class="btn btn-primary btn-icon-right size-lg">
                  <i class="icon icon-finish" aria-hidden="true"></i>
                  거주지 인증
                </button>
              </form>

            </div>

          </div>
        </div>
      </section>

    </main>


    <script>
      (function () {
        const form = document.getElementById("rsdcAuthForm");

        form.addEventListener("submit", async (e) => {
          e.preventDefault();

          const rrn1 = document.getElementById("rrn1").value.trim();
          const rrn2 = document.getElementById("rrn2").value.trim();
          if (!rrn1 || !rrn2) {
            alert("주민등록번호를 모두 입력해주세요.");
            return;
          }

          try {
            const res = await Common.sendSafe(`/spfnapl/rsdcAuth.do?rrn1=${rrn1}&rrn2=${rrn2}`, {
              method: 'POST',
              expect: 'json',
              clientErrorMsg: '인증 정보를 확인할 수 없습니다.',
              otherErrorMsg: '서버 통신 중 오류가 발생했습니다.'
            });

            if (res?.ok) {
              Common.MiniSPA.go('/spfnapl/sprtBz.do');
            }
          } catch (err) {
            console.error(err);
            alert("거주지 인증 중 오류가 발생했습니다.");
          }
        });
      })();
    </script>

  </th:block>
</th:block>

</html>