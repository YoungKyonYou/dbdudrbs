<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{component/header :: layout(~{::content})}">
  <th:block th:fragment="content">

    <!-- Breadcrumb -->
    <div id="breadcrumb">
      <div class="container">
        <nav>
          <ul>
            <li>홈</li>
            <li>소식</li>
            <li aria-current="page">공지사항</li>
          </ul>
        </nav>
      </div>
    </div>

    <main id="contents">
      <section class="section" id="grid">
        <div class="container">
          <!-- 제목 + 검색 -->
          <div class="title-wrap">
            <div class="flex justify-space-between">
              <h2 class="section-title">공지사항</h2>

              <div id="search-box">
                <form id="searchbar" th:object="${req}" method="get">
                  <select id="searchFieldSelect" class="dropdown size-lg" aria-label="검색 구분 선택">
                    <option value="ntcMttrTtlNm">제목</option>
                    <option value="ntcMttrCtt">내용</option>
                  </select>

                  <input id="searchInput" class="text-field size-lg" placeholder="검색어를 입력해주세요." aria-label="검색어"
                    autocomplete="off" enterkeyhint="search">

                  <button class="btn icon-only size-lg" type="submit" aria-label="검색">
                    <i class="icon icon-search" aria-hidden="true"></i>
                  </button>

                  <!-- VO 필드 hidden -->
                  <input id="ntcMttrTtlNm" th:field="*{ntcMttrTtlNm}" type="hidden">
                  <input id="ntcMttrCtt" th:field="*{ntcMttrCtt}" type="hidden">
                  <input th:field="*{sort}" type="hidden">
                  <input th:field="*{dir}" type="hidden">
                </form>
              </div>





            </div>
          </div>

          <!-- 게시판 목록 -->
          <div class="board-list">
            <h2 class="sr-only">공지 및 게시글 목록</h2>
            <div class="board-head" role="group" aria-label="목록 컬럼">
              <span class="col col-num">번호</span>
              <span class="col col-title">제목</span>
              <span class="col col-date">등록일</span>
            </div>

            <ul class="board-body" role="list">
              <!-- 빈 목록 -->
              <li class="board-row" th:if="${pageData == null or #lists.isEmpty(pageData.content)}">
                <div class="board-item">
                  <span class="col col-title">등록된 공지사항이 없습니다.</span>
                </div>
              </li>

              <!-- 공지사항 먼저 -->
              <li class="board-row" th:each="row, stat : ${pageData.content}" th:if="${row.mainExpsYn} == 'Y'"
                th:classappend="is-notice">
                <a class="board-item" th:href="@{'/news/ntcmttr/ntcMttrDtl/' + ${row.bltnNo}}">
                  <span class="col col-num"
                    th:text="${pageData.total - (pageData.page * pageData.size) - stat.index}">1</span>
                  <span class="col col-title">
                    <span class="badge badge-notice">공지</span>
                    <span th:text="${row.ntcMttrTtlNm}">제목</span>
                  </span>
                  <span class="col col-date"
                    th:text="${row.rgtDtm != null and row.rgtDtm.length() >= 8 ? #strings.substring(row.rgtDtm,0,4) + '.' + #strings.substring(row.rgtDtm,4,6) + '.' + #strings.substring(row.rgtDtm,6,8) : row.rgtDtm}">2025.05.07</span>
                </a>
              </li>

              <!-- 일반 게시글 -->
              <li class="board-row" th:each="row, stat : ${pageData.content}" th:if="${row.mainExpsYn} != 'Y'">
                <a class="board-item" th:href="@{'/news/ntcmttr/ntcMttrDtl/' + ${row.bltnNo}}">
                  <span class="col col-num"
                    th:text="${pageData.total - (pageData.page * pageData.size) - stat.index}">1</span>
                  <span class="col col-title" th:text="${row.ntcMttrTtlNm}">제목</span>
                  <span class="col col-date"
                    th:text="${row.rgtDtm != null and row.rgtDtm.length() >= 8 ? #strings.substring(row.rgtDtm,0,4) + '.' + #strings.substring(row.rgtDtm,4,6) + '.' + #strings.substring(row.rgtDtm,6,8) : row.rgtDtm}">2025.05.07</span>
                </a>
              </li>
            </ul>
          </div>

          <!-- 페이지네이션 -->
          <div id="grid-pager">
            <th:block th:replace="~{component/pagination :: pager(${pageData})}"></th:block>
          </div>
        </div>
      </section>

    </main>

    <!-- 스크립트 -->
    <script th:inline="javascript" type="text/javascript">
      (function () {
        const grid = document.getElementById('grid');
        const searchForm = grid.querySelector('form');
        const baseUrl = 'news/ntcmttr/ntcMttr.do';
        const inputSort = document.getElementById('sort');
        const inputDir = document.getElementById('dir');
        const selectSize = searchForm?.querySelector('select[name="size"]');

        const form = document.getElementById('searchbar');
        const select = document.getElementById('searchFieldSelect');
        const input = document.getElementById('searchInput');
        const titleField = document.getElementById('ntcMttrTtlNm');
        const contentField = document.getElementById('ntcMttrCtt');

        form.addEventListener('submit', function (e) {
          e.preventDefault();

          if (select.value === 'ntcMttrTtlNm') {
            titleField.value = input.value;
            contentField.value = '';
          } else {
            titleField.value = '';
            contentField.value = input.value;
          }

          applied = Common.collectFromForm(form);

          Common.reloadList({
            page: 0,
            defaultSortColumn: 'bltn_no',
            swapTargets: ['.board-body', '#grid-pager'],
            baseUrl,
            selectSize,
            inputSort,
            inputDir,
            applied
          });
        });
        bindPagination(baseUrl, {
          page: 0,
          size: parseInt(selectSize?.value || '10', 10),
          dir: inputDir?.value || 'asc',
          sort: inputSort?.value || 'rgtDtm',
        });
      })();
    </script>

    <!-- Footer / Top Button -->
    <th:block th:replace="~{component/footer :: siteFooter}"></th:block>
    <th:block th:replace="~{component/topBtn :: siteTop}"></th:block>

  </th:block>
</th:block>

</html>