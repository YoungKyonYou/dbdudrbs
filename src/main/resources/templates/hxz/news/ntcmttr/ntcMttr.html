<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" data-theme="light">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Tmoney 교통복지플랫폼" />
  <meta name="keywords" content="Tmoney 교통복지플랫폼" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Tmoney 교통복지플랫폼" />
  <meta property="og:description" content="Tmoney 교통복지플랫폼" />

  <title th:text="${pageTitle} ?: 'Tmoney 교통복지플랫폼'">Tmoney 교통복지플랫폼</title>

  <!-- 정적 리소스: /static/css/** → /css/** -->
  <link rel="stylesheet" th:href="@{/css/vendor/aos.css}" />
  <link rel="stylesheet" th:href="@{/css/vendor/swiper-bundle.min.css}" />
  <link rel="stylesheet" th:href="@{/css/index.css}" />
  <link rel="stylesheet" th:href="@{/css/page/page.css}" />
</head>

<body>



  <p id="skip-nav">
    <a href="#contents">본문으로 바로가기</a>
    <a href="#gnb1">주메뉴 바로가기</a>
  </p>

  <th:block th:replace="~{component/header :: siteHeader}"></th:block>

  <div id="breadcrumb">
    <div class="container">
      <nav>
        <ul>
          <li>홈</li>
          <li>소식</li>
          <li aria-current="page">공지사항</li>
        </ul>
      </nav>
    </div>
  </div>

  <main id="contents">
    <section class="section">
      <div class="container">
        <div class="title-wrap">
          <div class="flex justify-space-between">
            <h2 class="section-title">공지사항</h2>
            <div id="search-box">
              <!-- 검색 유형 드롭다운 -->


              <div class="dropdown size-lg" data-name="searchType" role="group" aria-labelledby="supportTypeTitle">
                <button type="button" id="supportTypeDropdownBtn" class="dropdown_button" aria-haspopup="listbox"
                  aria-expanded="false" aria-controls="supportTypeDropdownList" aria-label="공지사항 유형 선택 드롭다운">

                  <span class="dropdown_value" data-placeholder="전체">전체</span>
                </button>
                <ul class="dropdown_list" id="supportTypeDropdownList" role="listbox" tabindex="-1"
                  aria-labelledby="supportTypeDropdownBtn">
                  <!-- 각 option은 고유 id + aria-selected 하나만 true -->
                  <li id="supportTypeOptChild" role="option" class="dropdown_option" data-value="전체"
                    aria-selected="false">전체</li>
                  <li id="supportTypeOptTeen" role="option" class="dropdown_option" data-value="타입1"
                    aria-selected="false">타입1</li>
                  <li id="supportTypeOptSenior" role="option" class="dropdown_option" data-value="타입2"
                    aria-selected="false">타입2</li>
                </ul>
                <input type="hidden" name="supportType" value="">
              </div>
              <!-- 검색 폼 -->
              <form id="searchForm" role="search" th:action="@{/news/ntcmttr/ntcMttr.do}" method="get">
                <!-- hidden input으로 현재 선택된 searchType 값을 유지 -->
                <input type="hidden" name="searchType" th:value="${param.searchType} ?: 'all'">
                <input class="text-field size-lg" name="q" th:value="${param.q}" placeholder="검색어를 입력해주세요."
                  aria-label="검색어" autocomplete="off" enterkeyhint="search">
                <button class="btn icon-only size-lg" type="submit" aria-label="검색">
                  <i class="icon icon-search" aria-hidden="true"></i>
                </button>
              </form>
            </div>
          </div>
        </div>

        <div class="board-list">
          <h2 class="sr-only">공지 및 게시글 목록</h2>
          <div class="board-head" role="group" aria-label="목록 컬럼">
            <span class="col col-num">번호</span>
            <span class="col col-title">제목</span>
            <span class="col col-date">등록일</span>
          </div>
          <ul class="board-body" role="list">
            <li th:each="item, itemStat : ${pageData.content}"
              th:classappend="${item.mainExpsYn != null and #strings.equals(item.mainExpsYn, 'Y')} ? 'is-notice' : 'board-row'">
              <a class="board-item" th:href="@{'/news/ntcmttr/ntcMttrDtl/' + ${item.bltnNo}}">
                <span class="col col-num">
                  <span th:if="${item.mainExpsYn != null and #strings.equals(item.mainExpsYn, 'Y')}"
                    class="badge badge-notice" aria-label="공지">공지</span>
                  <span th:unless="${item.mainExpsYn != null and #strings.equals(item.mainExpsYn, 'Y')}"
                    th:text="${item.bltnNo}" aria-label="번호"></span>
                </span>
                <span class="col col-title" th:text="${item.ntcMttrTtlNm}"></span>
                <span class="col col-date" th:text="${item.tpwBltnRgtDtm}"></span>
              </a>
            </li>
            <!-- 게시글이 없을 경우 메시지 표시 -->
            <li th:if="${#lists.isEmpty(pageData.content)}" class="no-data board-row">
              <div class="board-item">
                <span class="col col-full">등록된 공지사항이 없습니다.</span>
              </div>
            </li>
          </ul>
        </div>

        <!--            &lt;!&ndash; 페이지네이션 &ndash;&gt;-->
        <!--            <nav class="pagination" aria-label="페이지네이션">-->
        <!--                <ul class="pagination-list" role="list">-->
        <!--                    &lt;!&ndash; 처음 페이지 &ndash;&gt;-->
        <!--                    <li class="page-ctrl">-->
        <!--                        <a class="page-btn"-->
        <!--                           th:href="@{/news/ntcmttr/ntcMttr.do(page=0, ntcMttrTtlNm=${param.ntcMttrTtlNm}, ntcMttrCtt=${param.ntcMttrCtt})}"-->
        <!--                           th:attr="aria-disabled=${pageData.page == 0} ? true : null"-->
        <!--                           th:classappend="${pageData.page == 0} ? 'disabled' : ''" aria-label="첫 페이지">-->
        <!--                            <i class="icon icon-arrow-left-end"></i>-->
        <!--                        </a>-->
        <!--                    </li>-->
        <!--                    &lt;!&ndash; 이전 페이지 &ndash;&gt;-->
        <!--                    <li class="page-ctrl">-->
        <!--                        <a class="page-btn"-->
        <!--                           th:href="@{/news/ntcmttr/ntcMttr.do(page=${pageData.page - 1}, ntcMttrTtlNm=${param.ntcMttrTtlNm}, ntcMttrCtt=${param.ntcMttrCtt})}"-->
        <!--                           th:attr="aria-disabled=${pageData.page == 0} ? true : null"-->
        <!--                           th:classappend="${pageData.page == 0} ? 'disabled' : ''" aria-label="이전 페이지">-->
        <!--                            <i class="icon icon-arrow-left"></i>-->
        <!--                        </a>-->
        <!--                    </li>-->

        <!--                    &lt;!&ndash; 숫자 페이지 &ndash;&gt;-->
        <!--                    <li th:each="i : ${#numbers.sequence(0, (pageData.totalPages > 0 ? pageData.totalPages - 1 : 0))}"-->
        <!--                        th:classappend="${i == pageData.page} ? 'is-current' : ''" class="page-num">-->
        <!--                        <a th:if="${i != pageData.page}"-->
        <!--                           th:href="@{/news/ntcmttr/ntcMttr.do(page=${i}, ntcMttrTtlNm=${param.ntcMttrTtlNm}, ntcMttrCtt=${param.ntcMttrCtt})}"-->
        <!--                           th:text="${i + 1}" th:aria-label="${i + 1} + '페이지'"></a>-->
        <!--                        <span th:if="${i == pageData.page}" th:text="${i + 1}" aria-current="page"></span>-->
        <!--                    </li>-->

        <!--                    &lt;!&ndash; 다음 페이지 &ndash;&gt;-->
        <!--                    <li class="page-ctrl">-->
        <!--                        <a class="page-btn"-->
        <!--                           th:href="@{/news/ntcmttr/ntcMttr.do(page=${pageData.page + 1}, ntcMttrTtlNm=${param.ntcMttrTtlNm}, ntcMttrCtt=${param.ntcMttrCtt})}"-->
        <!--                           th:attr="aria-disabled=${pageData.page + 1 >= pageData.totalPages} ? true : null"-->
        <!--                           th:classappend="${pageData.page + 1 >= pageData.totalPages} ? 'disabled' : ''" aria-label="다음 페이지">-->
        <!--                            <i class="icon icon-arrow-right"></i>-->
        <!--                        </a>-->
        <!--                    </li>-->
        <!--                    &lt;!&ndash; 마지막 페이지 &ndash;&gt;-->
        <!--                    <li class="page-ctrl">-->
        <!--                        <a class="page-btn"-->
        <!--                           th:href="@{/news/ntcmttr/ntcMttr.do(page=${pageData.totalPages > 0 ? pageData.totalPages - 1 : 0}, ntcMttrTtlNm=${param.ntcMttrTtlNm}, ntcMttrCtt=${param.ntcMttrCtt})}"-->
        <!--                           th:attr="aria-disabled=${pageData.page + 1 >= pageData.totalPages} ? true : null"-->
        <!--                           th:classappend="${pageData.page + 1 >= pageData.totalPages} ? 'disabled' : ''" aria-label="마지막 페이지">-->
        <!--                            <i class="icon icon-arrow-right-end"></i>-->
        <!--                        </a>-->
        <!--                    </li>-->
        <!--                </ul>-->
        <!--            </nav>-->

      </div>
    </section>

  </main>

  <th:block th:replace="~{component/footer :: siteFooter}"></th:block>
  <th:block th:replace="~{component/topBtn :: siteTop}"></th:block>

  <script th:src="@{/js/vendor/aos.js}"></script>
  <script th:src="@{/js/vendor/gsap.min.js}"></script>
  <script th:src="@{/js/vendor/ScrollTrigger.min.js}"></script>
  <script th:src="@{/js/vendor/swiper-bundle.min.js}"></script>

  <script type="module" th:src="@{/js/common.js}"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      if (window.AOS && !window.__aosInited) {
        AOS.init(); /* 옵션 필요 시 { duration: 600, once: true } */
        window.__aosInited = true;
      }

      // 드롭다운 초기화 및 검색 폼 제출 로직 (common.js에 통합 권장)
      const searchForm = document.getElementById('searchForm');
      const searchTypeDropdownBtn = document.getElementById('searchTypeDropdownBtn');
      const searchTypeDropdownList = document.getElementById('searchTypeDropdownList');
      const searchTypeValueSpan = searchTypeDropdownBtn ? searchTypeDropdownBtn.querySelector('.dropdown_value') : null;
      const searchTypeHiddenInput = searchForm ? searchForm.querySelector('input[name="searchType"]') : null;
      const searchTextInput = searchForm ? searchForm.querySelector('input[name="q"]') : null;

      if (searchTypeDropdownBtn && searchTypeDropdownList && searchTypeValueSpan && searchTypeHiddenInput && searchTextInput && searchForm) {
        // 초기값 설정
        const currentSearchType = searchTypeHiddenInput.value || 'all';
        const currentSearchTypeText = document.querySelector(`.dropdown_option[data-value="${currentSearchType}"]`)?.textContent || '전체';
        searchTypeValueSpan.textContent = currentSearchTypeText;
        document.querySelector(`.dropdown_option[data-value="${currentSearchType}"]`)?.setAttribute('aria-selected', 'true');

        // 드롭다운 버튼 클릭 이벤트
        searchTypeDropdownBtn.addEventListener('click', function () {
          const isExpanded = this.getAttribute('aria-expanded') === 'true';
          this.setAttribute('aria-expanded', !isExpanded);
          searchTypeDropdownList.style.display = isExpanded ? 'none' : 'block';
          if (!isExpanded) {
            searchTypeDropdownList.focus();
          }
        });

        // 드롭다운 옵션 선택 이벤트
        searchTypeDropdownList.addEventListener('click', function (event) {
          const targetOption = event.target.closest('.dropdown_option');
          if (targetOption) {
            const value = targetOption.dataset.value;
            const text = targetOption.textContent;

            searchTypeValueSpan.textContent = text;
            searchTypeHiddenInput.value = value;

            Array.from(this.children).forEach(option => {
              option.setAttribute('aria-selected', 'false');
            });
            targetOption.setAttribute('aria-selected', 'true');

            searchTypeDropdownBtn.setAttribute('aria-expanded', 'false');
            searchTypeDropdownList.style.display = 'none';

            // 드롭다운 선택 변경 시 자동 검색을 원한다면 주석 해제
            // searchForm.submit();
          }
        });

        // 포커스 아웃 시 드롭다운 닫기
        document.addEventListener('click', function (event) {
          if (!searchTypeDropdownBtn.contains(event.target) && !searchTypeDropdownList.contains(event.target)) {
            searchTypeDropdownBtn.setAttribute('aria-expanded', 'false');
            searchTypeDropdownList.style.display = 'none';
          }
        });

        // 폼 제출 시 SrchReqVO 필드에 맞게 파라미터 재구성 (핵심 로직)
        searchForm.addEventListener('submit', function (event) {
          event.preventDefault(); // 기본 폼 제출 방지

          const currentSearchType = searchTypeHiddenInput.value;
          const currentSearchQuery = searchTextInput.value;

          // 새로운 FormData 객체 생성
          const formData = new FormData();
          formData.append('page', '0'); // 검색 시 항상 첫 페이지로
          formData.append('size', '10'); // size 기본값 유지
          formData.append('sort', 'bltnNo'); // 정렬 필드 (SrchReqVO에 맞게)
          formData.append('dir', 'desc'); // 정렬 방향 (최신순)

          if (currentSearchQuery) {
            if (currentSearchType === 'title') {
              formData.append('ntcMttrTtlNm', currentSearchQuery);
            } else if (currentSearchType === 'content') {
              formData.append('ntcMttrCtt', currentSearchQuery);
            } else { // 'all' 또는 기본값
              formData.append('ntcMttrTtlNm', currentSearchQuery);
              formData.append('ntcMttrCtt', currentSearchQuery);
            }
          }

          // URLSearchParams로 변환하여 URL 쿼리 스트링으로 제출
          const queryParams = new URLSearchParams(formData).toString();
          window.location.href = searchForm.action + '?' + queryParams;
        });
      }
    });
  </script>
</body>

</html>