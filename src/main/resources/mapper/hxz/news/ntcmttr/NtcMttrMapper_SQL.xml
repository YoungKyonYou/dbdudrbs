<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="tmoney.co.kr.hxz.news.ntcmttr.mapper.NtcMttrMapper">

    <select id="readNtcMttrList" resultType="tmoney.co.kr.hxz.news.ntcmttr.vo.NtcMttrRspVO" parameterType="tmoney.co.kr.hxz.news.ntcmttr.vo.NtcMttrSrchReqVO">
        /* sql_id : readNtcMttrList */
        /*
        * 1. 파일 : NtcMttrMapper_SQL.xml
        * 2. 기능 : 공지사항 목록 조회
        * 3. 작성자 : 최중혁
        * 4. 변경이력 :
        2025.10.27 - 최중혁 : 최초작성
        */
        select org_cd as orgCd
             , bltn_no as bltnNo
             , bltn_dvs_cd as bltnDvsCd
             , tpw_bltn_rgt_dtm as tpwBltnRgtDtm
             , ntc_mttr_ttl_nm as ntcMttrTtlNm
             , ntc_mttr_ctt as ntcMttrCtt
             , main_exps_yn as mainExpsYn
             , main_exps_stt_dt as mainExpsSttDt
             , main_exps_end_dt as mainExpsEndDt
             , use_yn
             , inqr_ncnt as inqrNcnt
             , rgsr_id as rgsrId
             , rgt_dtm as rgtDtm
          from ohxzown.tbhxzm113
         where bltn_dvs_cd = '0'
        <if test="req.ntcMttrTtlNm != null and req.ntcMttrTtlNm != ''">
           and lower(ntc_mttr_ttl_nm) like concat('%', lower(#{req.ntcMttrTtlNm}), '%')
        </if>
        <if test="req.ntcMttrCtt != null and req.ntcMttrCtt != ''">
           and lower(ntc_mttr_ctt) like concat('%', lower(#{req.ntcMttrCtt}), '%')
        </if>
         order by main_exps_yn desc
             , ${req.sort} ${req.dir}
         limit #{req.size}
        offset #{req.page}
    </select>

    <select id="readNtcMttrListCnt" parameterType="tmoney.co.kr.hxz.news.ntcmttr.vo.NtcMttrSrchReqVO" resultType="long">
        /* sql_id : readNtcMttrListCnt */
        /*
        * 1. 파일 : NtcMttrMapper_SQL.xml
        * 2. 기능 : 공지사항 목록 카운트 조회
        * 3. 작성자 : 최중혁
        * 4. 변경이력 :
        2025.10.27 - 최중혁 : 최초작성
        */
        select count(1)
          from tbhxzm113
         where 1 = 1
        <if test="req.ntcMttrTtlNm != null and req.ntcMttrTtlNm != ''">
           and lower(ntc_mttr_ttl_nm) like concat('%', lower(#{req.ntcMttrTtlNm}), '%')
        </if>
        <if test="req.ntcMttrCtt != null and req.ntcMttrCtt != ''">
           and lower(ntc_mttr_ctt) like concat('%', lower(#{req.ntcMttrCtt}), '%')
        </if>
    </select>

    <select id="readNtcMttrDtl" resultType="tmoney.co.kr.hxz.news.ntcmttr.vo.NtcMttrRspVO" parameterType="String">
        /* sql_id : readNtcMttrDtl */
        /*
        * 1. 파일 : NtcMttrMapper_SQL.xml
        * 2. 기능 : 공지사항 상세 조회
        * 3. 작성자 : 최중혁
        * 4. 변경이력 :
        2025.10.28 - 최중혁 : 최초작성
        */
        select org_cd as orgCd
             , bltn_no as bltnNo
             , bltn_dvs_cd as bltnDvsCd
             , tpw_bltn_rgt_dtm as tpwBltnRgtDtm
             , ntc_mttr_ttl_nm as ntcMttrTtlNm
             , ntc_mttr_ctt as ntcMttrCtt
             , main_exps_yn as mainExpsYn
             , main_exps_stt_dt as mainExpsSttDt
             , main_exps_end_dt as mainExpsEndDt
             , use_yn as useYn
             , inqr_ncnt as inqrNcnt
             , rgsr_id as rgsrId
             , rgt_dtm as rgtDtm
          from ohxzown.tbhxzm113
         where 1 = 1
         <if test="bltnNo != null and bltnNo != ''">
           and lower(bltn_no) like concat('%', lower(#{bltnNo}), '%')
         </if>
    </select>

    <update id="updateNtcInqrNcnt" parameterType="String">
        /* sql_id : updateNtcInqrNcnt */
        /*
        * 1. 파일 : NtcMttrMapper_SQL.xml
        * 2. 기능 : 공지사항 조회 건수 수정
        * 3. 작성자 : 최중혁
        * 4. 변경이력 :
        2025.10.28 - 최중혁 : 최초작성
        */
        update ohxzown.tbhxzm113
           set inqr_ncnt = coalesce(inqr_ncnt, 0) + 1
         where 1 = 1
         <if test="bltnNo != null and bltnNo != ''">
           and bltn_no = #{bltnNo}
         </if>
    </update>
</mapper>
