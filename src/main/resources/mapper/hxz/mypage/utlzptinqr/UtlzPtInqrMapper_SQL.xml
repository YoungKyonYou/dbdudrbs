<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="tmoney.co.kr.hxz.mypage.utlzptinqr.mapper.UtlzPtInqrMapper">

    <select id="readUtlzPtInqr" resultType="tmoney.co.kr.hxz.mypage.utlzptinqr.vo.UtlzPtInqrRspVO">
        /* sql_id : readUtlzPtInqr */
        /*
        * 1. 파일 : UtlzPtInqrMapper_SQL.xml
        * 2. 기능 : 이용 내역 조회
        * 3. 작성자 : 최중혁
        * 4. 변경이력 :
        2025.11.15 - 최중혁 : 최초작성
        */
        select m201.tpw_svc_id         as tpwSvcId
             , d209.stlm_dt as stlmDt
             , d209.trd_dt as trdDt
             , d209.trd_amt as trdAmt
          from ohxzown.tbhxzm201 m201
          join ohxzown.tbhxzd209 d209
            on d209.tpw_svc_id = m201.tpw_svc_id
           and d209.mbrs_id = #{mbrsId}
          left join ohxzown.tbhxzm102 m102
            on m102.tpw_svc_id = m201.tpw_svc_id
           and m102.mbrs_id = #{mbrsId}
         where 1 = 1
         <if test="req.stlmDt != null and req.stlmDt != ''">
             and d209.stlm_dt like #{req.stlmDt} || '%'
         </if>
           and m201.tpw_svc_id = #{req.tpwSvcId}
           and m201.use_yn = upper('y')
         order by ${req.sort} ${req.dir}
         limit #{req.size}
        offset #{req.page}
    </select>

    <select id="readUtlzPtInqrCnt" resultType="long">
        /* sql_id : readUtlzPtInqrCnt */
        /*
        * 1. 파일 : MyPageMapper_SQL.xml
        * 2. 기능 : 이용 내역 결과 카운트 조회
        * 3. 작성자 : 최중혁
        * 4. 변경이력 :
        2025.11.15 - 최중혁 : 최초작성
        */
        select count(1)
          from ohxzown.tbhxzm201 m201
          join ohxzown.tbhxzd209 d209
            on d209.tpw_svc_id = m201.tpw_svc_id
           and d209.mbrs_id = #{mbrsId}
          left join ohxzown.tbhxzm102 m102
            on m102.tpw_svc_id = m201.tpw_svc_id
           and m102.mbrs_id = #{mbrsId}
         where 1 = 1
        <if test="req.stlmDt != null and req.stlmDt != ''">
           and d209.stlm_dt like #{req.stlmDt} || '%'
        </if>
           and m201.tpw_svc_id = #{req.tpwSvcId}
           and m201.use_yn = upper('y')
    </select>

</mapper>